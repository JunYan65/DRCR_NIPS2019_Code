k = 7
K = 100

l1_loss = zeros(K,k);
l2_loss = zeros(K,k);


%random('T',10,d,n)


for iter = 1:K
disp(iter)
disp(100)
    for j = 1:k
        n = 50*j;
        d = 5;
        X = random('T',10,d,n);
        %X = randn(d, n);
        % target function f=|x_1|+...+|x_d|
        Y_star = sum(abs(X),1);
        %Y_star = sqrt(sum(X.^2,1));
        Y = Y_star + 0.2 * randn(1,n);
        Ys = Y;
        % bandwidth %
        %h = 0.3*n^(-1/(5+d-1))*ones(1,d);
        %h=n^(-1/5)*[1;1;1;1;1]; 
        %a = [1;1;1;1;1]
        marki = 0;
        markloss = 1000;
        for ci = 1:100
            h = (ci/100)*n^(-1/(5+d-1))*ones(1,d);
            for i=1:n
                    Ys(i)=gaussian_kern_reg(X(:,i),X,Y,h); % Prediction
            end
            loss_cv = sumsqr(Ys - Y_star)/n;
            if loss_cv < markloss
                marki = ci;
                markloss = loss_cv;
            end
        end
        %disp(marki);
        h = (marki/100)*n^(-1/(5+d-1))*ones(1,d);
        for i=1:n
                Ys(i)=gaussian_kern_reg(X(:,i),X,Y,h); % Prediction
        end
        loss_1 = sum(abs(Ys - Y_star))/n;
        loss_2 = sqrt(sumsqr(abs(Ys - Y_star))/n);
        l1_loss(iter,j) = loss_1;
        l2_loss(iter,j) = loss_2;
    end
end
l1_loss
l2_loss

mml1 = [0.1480    0.1431    0.1403    0.1358    0.1339    0.1344    0.1308]
mml2 = [0.1837    0.1792    0.1763    0.1720    0.1693    0.1697    0.1658]


mmml1 = [0.1557    0.1561    0.1568    0.1569    0.1548    0.1542    0.1537]
mmml2 = [0.1950    0.1958    0.1957    0.1962    0.1937    0.1930    0.1927]

mean(l1_loss)

mean(l2_loss)



x = [50, 100, 150, 200, 250, 300, 350]
%l1l1 = [1.602340603588761625e-01,1.492891643648620592e-01,1.454111214929247053e-01,1.435866532161658715e-01,1.391864607964792833e-01,1.384331820610273933e-01,1.353117579187923247e-01]
%l2l1 = [1.654956745262753381e-01,1.521903236885151223e-01,1.522312429573392800e-01,1.481861351033676444e-01,1.436820674018036981e-01,1.444590573855940585e-01,1.362027725988599336e-01]

l1l1 = [1.463668567910370033e-01,1.491053633945154944e-01,1.441934395399974422e-01,1.413762179784303630e-01,1.414469584808398239e-01,1.387298794952795400e-01,1.367442130411046231e-01]
l2l1 = [1.583093496586258364e-01,1.615826054497772335e-01,1.570655860114797409e-01,1.508922644194902740e-01,1.467256710046526136e-01,1.482975463023331886e-01,1.430892812288493965e-01]
badl1 = [2.094784269990729864e-01,2.281624906827788013e-01,2.310401929071213833e-01,2.351895589120300278e-01,2.421430775948240355e-01,2.412166987154298614e-01,2.431854419802819967e-01]

hold on
plot(x, l1l1, 'b', 'LineWidth',4)
plot(x, l2l1, 'r-.', 'LineWidth',4)
plot(x, badl1, 'black:', 'LineWidth',4)
plot(x, mmml1, 'g--', 'LineWidth',4)
%title('Empirical l_1 Loss','fontsize',18)
xlabel('n','fontsize',18)
ylabel('Loss','fontsize',18)
axis([50 350 0.12 0.32])
set(gca,'FontSize',12)
legend({'DRCR','LSE_{10}','LSE_{0.8}','Kernel'},'fontsize',15)



x = [50, 100, 150, 200, 250, 300, 350]
%l1l2 = [1.991269285327816885e-01,1.852614734664686513e-01,1.818286665966688809e-01,1.808837325587680511e-01,1.729691023719050480e-01,1.729163716602781509e-01,1.693179760790344546e-01]
%l2l2 = [2.031362295746143576e-01,1.913451110043015435e-01,1.906983882553169585e-01,1.858472881054900605e-01,1.785197483331248669e-01,1.790565414184708826e-01,1.711567390496485097e-01]

l1l2 = [1.826126599405118456e-01,1.881246138958095615e-01,1.817024330095934892e-01,1.773369647816765149e-01,1.784279045323383384e-01,1.747326979021176785e-01,1.722120084800067841e-01]
l2l2 = [1.992259229549852018e-01,2.017990046722300534e-01,1.952543438931085562e-01,1.900759881278767383e-01,1.843655158611318956e-01,1.863423497610942059e-01,1.812128978331133677e-01]

badl2 = [2.670569474229007034e-01,2.876538651433476756e-01,2.948478902541936120e-01,2.983829795002144181e-01,3.085790631064039835e-01,3.061024627240033213e-01,3.060127279226596553e-01]



hold on
plot(x, l1l2, 'b', 'LineWidth',4)
plot(x, l2l2, 'r-.', 'LineWidth',4)
plot(x, badl2, 'black:', 'LineWidth',4)
plot(x, mmml2, 'g--', 'LineWidth',4)

title('Empirical l_2 Loss','fontsize',18)
xlabel('n','fontsize',18)
ylabel('Loss','fontsize',18)
axis([50 350 0.12 0.32])
set(gca,'FontSize',12)
legend({'DRCR','LSE_{10}','LSE_{0.8}','Kernel'},'fontsize',15)


